<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>一覧画面</title>
    <link rel="stylesheet" href="https://unpkg.com/sanitize.css" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <p>
      店名選択：<select id="shopList">
        <option value=""></option>
        <option value="日本橋本店">日本橋本店</option>
        <option value="新宿店">新宿店</option>
        <option value="長野店">長野店</option>
      </select>
    </p>

    <form action="List.html" id="shopForm">
      <table id="shopTable">
        <tr>
          <th>商品ID</th>
          <th>商品名</th>
          <th>値段(円)</th>
          <th>注文数</th>
          <th>金額(円)</th>
        </tr>
        <tr>
          <td>001</td>
          <td>りんご</td>
          <td>200</td>
          <td class="order"></td>
          <td><div class="red" id="kingaku0"></div></td>
        </tr>
        <tr>
          <td>007</td>
          <td>甘栗</td>
          <td>300</td>
          <td class="order"></td>
          <td><div class="red" id="kingaku1"></div></td>
        </tr>
      </table>
      <div class="red" id="goukei"></div>
      <button type="submit">送信する</button>
    </form>
  </body>
  <script>
    let shopName; //選択した店名
    let shopList = document.getElementById('shopList');
    shopList.addEventListener('change', function (event) {
      //イベントが発生すると、eventオブジェクトが関数に渡される
      shopName = event.target.value;

      let shopForm = document.getElementById('shopForm');
      if (shopName != '' && shopForm) {
        //店名が空白でない場合＝店が選ばれた場合かつ店の票が存在する場合
        shopForm.remove(); //店の表をまず削除し、選ばれた店を表示させる
        console.log('shopName1' + shopName);
      } else if ((shopName = '' && shopForm)) {
        shopForm.remove();
      } else if (shopName != '' && !shopForm) {
        console.log('shopName2' + shopName);
      }
    });
  </script>
  <script>
    orderList();

    function orderList() {
      let select = [];
      let order = document.getElementsByClassName('order');
      // order[0].innerHTML = '<select id="select0"><option>1</option></select>';
      // order[1].innerHTML = '<select id="select1"><option>1</option></select>';

      for (let i = 0; i < order.length; i++) {
        let selectHtml = '<select id=select' + i + '>';
        for (let j = 0; j < 10; j++) {
          selectHtml = selectHtml + '<option>' + j + '</option>';
        }

        order[i].innerHTML = selectHtml + '</select>';
        select[i] = document.getElementById('select' + i); //IDに対して、要素（select０、select１）を読み取るdocumentのメソッド。select[i]に格納
        select[i].addEventListener('change', calc); //select[i]にaddEventListenerメソッド（変化を読み取るメソッド）
      }
    }
    function calc() {
      let goukei = 0;
      let elements; //form内の要素
      let orderNumber; //要素の値(注文数)
      let kingakuElement; //金額を表示する要素
      let price; //一覧表の値段(円)
      let order = document.getElementsByClassName('order');
      let shopTable = document.getElementById('shopTable');
      let goukeiElement = document.getElementById('goukei');

      for (let i = 0; i < order.length; i++) {
        elements = document.forms[0].elements[i]; //.formsはHTMLの<form>に割り当て。.elements[i]はformの入力項目に割り当て。[i]は入力要素の注文数の１番目（行目）、２番目（行目）を指す。
        orderNumber = elements.value;
        price = shopTable.rows[i + 1].cells[2].innerText;

        if (orderNumber > 0) {
          kingakuElement = document.getElementById('kingaku' + i);
          kingakuElement.innerHTML = orderNumber * price;
          goukei += orderNumber * price;
          goukeiElement.innerHTML = '合計支払い金額：' + goukei + '円';
        }
      }
    }
  </script>
</html>
